---
title: Overview
description: Content-type aware marshaling with field sanitization for Go
author: zoobzio
published: 2025-12-27
updated: 2025-12-27
tags:
  - Overview
  - Introduction
---

# Overview

Serializing sensitive data means choosing between security and convenience.

Codec offers both: type-safe marshaling with automatic field sanitization.

```go
type User struct {
    ID       string `json:"id"`
    Email    string `json:"email" mask:"email"`
    Password string `json:"password" encrypt:"pii"`
    SSN      string `json:"ssn" mask:"ssn"`
    Token    string `json:"token" hash:"sha256"`
}

func (u User) Clone() User { return u }

func main() {
    enc, _ := codec.AES(key)
    ser, _ := codec.NewSerializer[User](
        json.New(),
        codec.WithEncryptor("pii", enc),
        codec.WithHasher("sha256", codec.SHA256()),
    )

    data, _ := ser.Marshal(&user)
    // {"id":"123","email":"a***@example.com","password":"<encrypted>","ssn":"***-**-6789","token":"<hash>"}

    restored, _ := ser.Unmarshal(data)
    // restored.Password == original password (decrypted)
}
```

Struct tags declare intent. The serializer handles the rest.

## Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                           Codec                                 │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                   Serializer[T]                          │   │
│  │  ┌──────────────┐   ┌──────────────┐   ┌─────────────┐  │   │
│  │  │  Sanitizer   │   │    Codec     │   │  Sentinel   │  │   │
│  │  │              │   │              │   │  Metadata   │  │   │
│  │  │  Encryptors  │   │  Marshal()   │   │  (cached)   │  │   │
│  │  │  Hashers     │   │  Unmarshal() │   │             │  │   │
│  │  │  Maskers     │   │              │   │             │  │   │
│  │  └──────────────┘   └──────────────┘   └─────────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                      Providers                           │   │
│  │   JSON        XML        YAML        MessagePack         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

The `Serializer[T]` wraps a codec with sanitization capabilities. On marshal, it clones the input, applies sanitization based on struct tags, then encodes. On unmarshal, it decodes and restores encrypted fields.

## Philosophy

Sanitization belongs in the type definition, not scattered across your codebase. A `Password` field tagged with `encrypt:"pii"` is always encrypted when serialized—no runtime decisions, no forgotten transforms.

```go
// The type declares its own security requirements
type Credentials struct {
    Username string `json:"username"`
    Password string `json:"password" encrypt:"pii"`
    APIKey   string `json:"api_key" hash:"sha256"`
}
```

Three lines. Three security guarantees. Every marshal, every time.

## Capabilities

**[Encryption](3.guides/1.encryption.md)** - AES-GCM, RSA-OAEP, and envelope encryption. Encrypted fields are automatically decrypted on unmarshal.

**[Masking](3.guides/2.masking.md)** - Content-aware partial masking. SSN becomes `***-**-6789`. Email becomes `a***@example.com`. Eight built-in patterns.

**[Hashing](3.guides/1.encryption.md#hashing)** - One-way SHA-256 and SHA-512. For tokens, passwords stored elsewhere, audit trails.

**[Redaction](5.reference/2.tags.md#redact)** - Full replacement with a mask string. `redact:"[HIDDEN]"` replaces the entire value.

**[Escape Hatches](4.cookbook/1.escape-hatches.md)** - Implement `Sanitizable` or `Desanitizable` to bypass reflection for performance-critical paths.

## Priorities

### Type Safety

Serializers are generic. A `Serializer[User]` only accepts `*User` values. Type constraints are enforced at compile time.

```go
type User struct { ... }
func (u User) Clone() User { return u }

ser, _ := codec.NewSerializer[User](json.New())
ser.Marshal(&user)       // OK
ser.Marshal(&otherType)  // Compile error
```

### Fail Fast

Missing encryptors or hashers are detected at serializer creation, not at marshal time.

```go
type Record struct {
    Secret string `encrypt:"custom"`
}

// Fails immediately: no encryptor registered for "custom"
ser, err := codec.NewSerializer[Record](json.New())
```

### Non-Destructive

Original values are never modified. The serializer clones before sanitizing.

```go
original := &User{Password: "secret"}
data, _ := ser.Marshal(original)

// original.Password is still "secret"
// data contains the encrypted value
```

### Provider Agnostic

Swap codecs without changing your types. JSON today, MessagePack tomorrow.

```go
jsonSer, _ := codec.NewSerializer[User](json.New(), opts...)
msgpackSer, _ := codec.NewSerializer[User](msgpack.New(), opts...)

// Same type, same tags, different wire format
```
