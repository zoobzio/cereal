---
title: API Reference
description: Complete API reference for the codec package
author: zoobzio
published: 2025-12-27
updated: 2025-12-27
tags:
  - Reference
  - API
  - Functions
  - Types
---

# API Reference

Complete API reference for `github.com/zoobzio/codec`.

## Core Interfaces

### Codec

```go
type Codec interface {
    ContentType() string
    Marshal(v any) ([]byte, error)
    Unmarshal(data []byte, v any) error
}
```

Content-type aware marshaling. Implemented by providers in `pkg/*`.

### Cloner[T]

```go
type Cloner[T any] interface {
    Clone() T
}
```

Required constraint for types used with `Serializer[T]`. Returns a copy to avoid mutating the original during sanitization.

### Sanitizable

```go
type Sanitizable interface {
    Sanitize() error
}
```

Escape hatch for custom pre-marshal sanitization. When implemented, bypasses reflection.

### Desanitizable

```go
type Desanitizable interface {
    Desanitize() error
}
```

Escape hatch for custom post-unmarshal restoration. When implemented, bypasses reflection.

## Serializer

### NewSerializer

```go
func NewSerializer[T Cloner[T]](codec Codec, opts ...Option) (*Serializer[T], error)
```

Creates a typed serializer with sanitization capabilities. Returns an error if required encryptors or hashers are missing for the type's tags.

### Methods

#### ContentType

```go
func (s *Serializer[T]) ContentType() string
```

Returns the underlying codec's content type.

#### Marshal

```go
func (s *Serializer[T]) Marshal(obj *T) ([]byte, error)
```

Clones the object, applies sanitization, and marshals to bytes.

#### Unmarshal

```go
func (s *Serializer[T]) Unmarshal(data []byte) (*T, error)
```

Unmarshals bytes to a new object and restores encrypted fields.

## Registry

### Use

```go
func Use[T Cloner[T]](codec Codec, opts ...Option) (*Serializer[T], error)
```

Returns a cached serializer or creates and caches a new one. Thread-safe.

### Reset

```go
func Reset()
```

Clears the serializer registry. Primarily useful for test isolation.

## Encryptors

### Encryptor Interface

```go
type Encryptor interface {
    Encrypt(plaintext []byte, ctx string) ([]byte, error)
    Decrypt(ciphertext []byte, ctx string) ([]byte, error)
}
```

The `ctx` parameter receives the tag value (e.g., "pii" from `encrypt:"pii"`).

### AES

```go
func AES(key []byte) (Encryptor, error)
```

AES-GCM encryptor. Key must be 16, 24, or 32 bytes (AES-128, AES-192, AES-256).

### RSA

```go
func RSA(pub *rsa.PublicKey, priv *rsa.PrivateKey) Encryptor
```

RSA-OAEP encryptor. Pass `nil` for `priv` to create encrypt-only.

### Envelope

```go
func Envelope(masterKey []byte) (Encryptor, error)
```

Envelope encryptor using per-message data keys. Master key must be 16, 24, or 32 bytes.

## Hashers

### Hasher Interface

```go
type Hasher interface {
    Hash(data []byte) string
}
```

Returns hex-encoded hash.

### SHA256

```go
func SHA256() Hasher
```

SHA-256 hasher.

### SHA512

```go
func SHA512() Hasher
```

SHA-512 hasher.

## Maskers

### MaskType

```go
type MaskType string

const (
    MaskSSN   MaskType = "ssn"
    MaskEmail MaskType = "email"
    MaskPhone MaskType = "phone"
    MaskCard  MaskType = "card"
    MaskIP    MaskType = "ip"
    MaskUUID  MaskType = "uuid"
    MaskIBAN  MaskType = "iban"
    MaskName  MaskType = "name"
)
```

Built-in mask types for the `mask` tag.

### Masker Interface

```go
type Masker interface {
    Mask(value string) string
}
```

Content-aware partial masking.

### Built-in Maskers

```go
func SSNMasker() Masker
func EmailMasker() Masker
func PhoneMasker() Masker
func CardMasker() Masker
func IPMasker() Masker
func UUIDMasker() Masker
func IBANMasker() Masker
func NameMasker() Masker
```

## Options

### WithEncryptor

```go
func WithEncryptor(ctx string, e Encryptor) Option
```

Registers an encryptor for a tag value. Example: `WithEncryptor("pii", enc)` handles `encrypt:"pii"`.

### WithEncryptors

```go
func WithEncryptors(m map[string]Encryptor) Option
```

Bulk registration of encryptors.

### WithHasher

```go
func WithHasher(algo string, h Hasher) Option
```

Registers a hasher for a tag value. Example: `WithHasher("sha256", SHA256())` handles `hash:"sha256"`.

### WithHashers

```go
func WithHashers(m map[string]Hasher) Option
```

Bulk registration of hashers.

## Providers

### JSON

```go
import "github.com/zoobzio/codec/pkg/json"

func New() codec.Codec
```

Content-Type: `application/json`

### XML

```go
import "github.com/zoobzio/codec/pkg/xml"

func New() codec.Codec
```

Content-Type: `application/xml`

### YAML

```go
import "github.com/zoobzio/codec/pkg/yaml"

func New() codec.Codec
```

Content-Type: `application/yaml`

### MessagePack

```go
import "github.com/zoobzio/codec/pkg/msgpack"

func New() codec.Codec
```

Content-Type: `application/msgpack`
