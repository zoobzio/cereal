---
title: API Reference
description: Complete API reference for the codec package
author: zoobzio
published: 2025-12-27
updated: 2025-12-27
tags:
  - Reference
  - API
  - Functions
  - Types
---

# API Reference

Complete API reference for `github.com/zoobzio/codec`.

## Core Interfaces

### Codec

```go
type Codec interface {
    ContentType() string
    Marshal(v any) ([]byte, error)
    Unmarshal(data []byte, v any) error
}
```

Content-type aware marshaling. Implemented by providers in `json/`, `xml/`, `yaml/`, `msgpack/`, `bson/`.

### Cloner[T]

```go
type Cloner[T any] interface {
    Clone() T
}
```

Required constraint for types used with `Processor[T]`. Returns a copy to avoid mutating the original during transforms.

## Override Interfaces

### Hashable

```go
type Hashable interface {
    Hash(hashers map[HashAlgo]Hasher) error
}
```

Bypasses reflection-based hashing during `Receive`.

### Encryptable

```go
type Encryptable interface {
    Encrypt(encryptors map[EncryptAlgo]Encryptor) error
}
```

Bypasses reflection-based encryption during `Store`.

### Decryptable

```go
type Decryptable interface {
    Decrypt(encryptors map[EncryptAlgo]Encryptor) error
}
```

Bypasses reflection-based decryption during `Load`.

### Maskable

```go
type Maskable interface {
    Mask(maskers map[MaskType]Masker) error
}
```

Bypasses reflection-based masking during `Send`.

### Redactable

```go
type Redactable interface {
    Redact() error
}
```

Bypasses reflection-based redaction during `Send`.

## Processor

### NewProcessor

```go
func NewProcessor[T Cloner[T]](codec Codec) (*Processor[T], error)
```

Creates a typed processor with boundary-aware transforms. Scans the type for tags and builds field plans.

### Methods

#### Receive

```go
func (p *Processor[T]) Receive(ctx context.Context, data []byte) (*T, error)
```

Unmarshals bytes and applies `receive.hash` transforms. Use for incoming external data.

#### Load

```go
func (p *Processor[T]) Load(ctx context.Context, data []byte) (*T, error)
```

Unmarshals bytes and applies `load.decrypt` transforms. Use for data from storage.

#### Store

```go
func (p *Processor[T]) Store(ctx context.Context, obj *T) ([]byte, error)
```

Clones, applies `store.encrypt` transforms, and marshals to bytes. Use for data going to storage.

#### Send

```go
func (p *Processor[T]) Send(ctx context.Context, obj *T) ([]byte, error)
```

Clones, applies `send.mask` and `send.redact` transforms, and marshals to bytes. Use for outgoing external data.

#### SetEncryptor

```go
func (p *Processor[T]) SetEncryptor(algo EncryptAlgo, enc Encryptor) *Processor[T]
```

Registers an encryptor for an algorithm. Returns the processor for chaining. Thread-safe.

#### SetHasher

```go
func (p *Processor[T]) SetHasher(algo HashAlgo, h Hasher) *Processor[T]
```

Registers a hasher for an algorithm. Returns the processor for chaining. Thread-safe.

#### SetMasker

```go
func (p *Processor[T]) SetMasker(mt MaskType, m Masker) *Processor[T]
```

Registers a masker for a mask type. Returns the processor for chaining. Thread-safe.

#### Validate

```go
func (p *Processor[T]) Validate() error
```

Checks that all algorithms referenced in tags have registered handlers. Call before using the processor.

#### ContentType

```go
func (p *Processor[T]) ContentType() string
```

Returns the underlying codec's content type.

## Registry

### Use

```go
func Use[T Cloner[T]](codec Codec) (*Processor[T], error)
```

Returns a cached processor or creates and caches a new one. Thread-safe.

### Reset

```go
func Reset()
```

Clears the processor registry. Primarily useful for test isolation.

## Encryptors

### Encryptor Interface

```go
type Encryptor interface {
    Encrypt(plaintext []byte) ([]byte, error)
    Decrypt(ciphertext []byte) ([]byte, error)
}
```

### EncryptAlgo

```go
type EncryptAlgo string

const (
    EncryptAES      EncryptAlgo = "aes"
    EncryptRSA      EncryptAlgo = "rsa"
    EncryptEnvelope EncryptAlgo = "envelope"
)
```

### AES

```go
func AES(key []byte) (Encryptor, error)
```

AES-GCM encryptor. Key must be 16, 24, or 32 bytes (AES-128, AES-192, AES-256).

### RSA

```go
func RSA(pub *rsa.PublicKey, priv *rsa.PrivateKey) Encryptor
```

RSA-OAEP encryptor. Pass `nil` for `priv` to create encrypt-only.

### Envelope

```go
func Envelope(masterKey []byte) (Encryptor, error)
```

Envelope encryptor using per-message data keys. Master key must be 16, 24, or 32 bytes.

## Hashers

### Hasher Interface

```go
type Hasher interface {
    Hash(data []byte) (string, error)
}
```

Returns the hash as a string (typically hex-encoded or PHC format).

### HashAlgo

```go
type HashAlgo string

const (
    HashSHA256 HashAlgo = "sha256"
    HashSHA512 HashAlgo = "sha512"
    HashArgon2 HashAlgo = "argon2"
    HashBcrypt HashAlgo = "bcrypt"
)
```

### SHA256Hasher

```go
func SHA256Hasher() Hasher
```

SHA-256 hasher. Returns 64 hex characters.

### SHA512Hasher

```go
func SHA512Hasher() Hasher
```

SHA-512 hasher. Returns 128 hex characters.

### Argon2

```go
func Argon2() Hasher
```

Argon2id hasher with default parameters.

### Argon2WithParams

```go
func Argon2WithParams(params Argon2Params) Hasher
```

Argon2id hasher with custom parameters.

### Argon2Params

```go
type Argon2Params struct {
    Time    uint32 // iterations
    Memory  uint32 // memory in KB
    Threads uint8
    KeyLen  uint32
    SaltLen uint32
}

func DefaultArgon2Params() Argon2Params
```

### Bcrypt

```go
func Bcrypt() Hasher
```

bcrypt hasher with default cost (10).

### BcryptWithCost

```go
func BcryptWithCost(cost int) Hasher
```

bcrypt hasher with custom cost.

## Maskers

### Masker Interface

```go
type Masker interface {
    Mask(value string) string
}
```

Content-aware partial masking.

### MaskType

```go
type MaskType string

const (
    MaskSSN   MaskType = "ssn"
    MaskEmail MaskType = "email"
    MaskPhone MaskType = "phone"
    MaskCard  MaskType = "card"
    MaskIP    MaskType = "ip"
    MaskUUID  MaskType = "uuid"
    MaskIBAN  MaskType = "iban"
    MaskName  MaskType = "name"
)
```

### Validation Functions

```go
func IsValidEncryptAlgo(algo EncryptAlgo) bool
func IsValidHashAlgo(algo HashAlgo) bool
func IsValidMaskType(mt MaskType) bool
```

## Providers

### JSON

```go
import "github.com/zoobzio/codec/json"

func New() codec.Codec
```

Content-Type: `application/json`

### XML

```go
import "github.com/zoobzio/codec/xml"

func New() codec.Codec
```

Content-Type: `application/xml`

### YAML

```go
import "github.com/zoobzio/codec/yaml"

func New() codec.Codec
```

Content-Type: `application/yaml`

### MessagePack

```go
import "github.com/zoobzio/codec/msgpack"

func New() codec.Codec
```

Content-Type: `application/msgpack`

### BSON

```go
import "github.com/zoobzio/codec/bson"

func New() codec.Codec
```

Content-Type: `application/bson`

## Signals

Codec emits signals via capitan for observability:

```go
var (
    SignalProcessorCreated = capitan.NewSignal("codec.processor.created", "...")
    SignalReceiveStart     = capitan.NewSignal("codec.receive.start", "...")
    SignalReceiveComplete  = capitan.NewSignal("codec.receive.complete", "...")
    SignalLoadStart        = capitan.NewSignal("codec.load.start", "...")
    SignalLoadComplete     = capitan.NewSignal("codec.load.complete", "...")
    SignalStoreStart       = capitan.NewSignal("codec.store.start", "...")
    SignalStoreComplete    = capitan.NewSignal("codec.store.complete", "...")
    SignalSendStart        = capitan.NewSignal("codec.send.start", "...")
    SignalSendComplete     = capitan.NewSignal("codec.send.complete", "...")
)
```

Context flows through for trace correlation.
